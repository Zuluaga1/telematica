<!DOCTYPE html>
<html>
<head>
    <title>MODULO DE VISUALIZACION (MEDICO)</title>
    <style>
         #map {
                height: 100%;
                width: 70%;
                position:absolute;
                top: 0;
                left: 0;
                z-index: 0;
            }
   </style>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
</head>

<body>
    <div style="position:absolute; top:60px; left:0px; z-index:5; width:350px; height:500px; background-color:#CDCDCD; opacity:0.9">

        <form
            style="position:absolute; top:45px; left:5px; z-index: 10;"
            name="formulario_fecha" id="formulario_fecha">

            <input type="button" value="Busqueda" id="historia" onclick="initMap(), validate()">
            <input type="button" value="Ubicacion en vivo" id="live">

        </form>

        <font color=#000000>
            <h1 style= "font-size:0.8cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:0.2cm; top: -10px;" ><i>AUCH</i></h1>
        </font>
        <form
            style="display: block; position:absolute; top:305px; left:10px; z-index: 10;"
            name="form_fecha" id="form_fecha" autocomplete="off" target="dummyframe" >

            <label for="inicio"> Ingrese CÃ©dula del paciente o el ID del caso:</label>
            <input type="text" id="fname" name="fname" required><br>
            <input type="submit" value="Submit" id="btnSubmit" onclick="validate()">
        </form>
    </div>

    <div style="position:absolute; top:350px; left:1060px; z-index:15; width:350px; height:350px; background-color:#CDCDCD; opacity:0.9">
        <h1 style= "font-size:0.8cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:0.2cm; top: -10px;" ><i>Informacion del paciente</i></h1>

        <h2 style= "font-size:0.5cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:0.3cm; top: 45px;" ><i>ID del caso:</i></h2>
        <h2 style= "font-size:0.4cm;font-family:'Times New Roman', Times, serif; position:absolute; z-index: 10; left:3.0cm; top: 38px;" ><p id="idcaso"></p></h2>

        <h2 style= "font-size:0.5cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:0.3cm; top: 65px;" ><i>Nombre:</i></h2>
        <h2 style= "font-size:0.4cm;font-family:'Times New Roman', Times, serif; position:absolute; z-index: 10; left:2.3cm; top: 55px;" ><p id="nombre"></p></h2>

        <h2 style= "font-size:0.5cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:0.3cm; top: 85px;" ><i>Apellido:</i></h2>
        <h2 style= "font-size:0.4cm;font-family:'Times New Roman', Times, serif; position:absolute; z-index: 10; left:2.3cm; top: 75px;" ><p id="apellido"></p></h2>

        <h2 style= "font-size:0.5cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:0.3cm; top: 105px;" ><i>Cedula:</i></h2>
        <h2 style= "font-size:0.4cm;font-family:'Times New Roman', Times, serif; position:absolute; z-index: 10; left:2.1cm; top: 98px;" ><p id="cedula"></p></h2>

        <h3 style= "font-size:0.5cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:0.3cm; top: 125px;" ><i>Sexo:</i></h3>
        <h2 style= "font-size:0.4cm;font-family:'Times New Roman', Times, serif; position:absolute; z-index: 10; left:1.7cm; top: 118px;" ><p id="sexo"></p></h2>

        <h3 style= "font-size:0.5cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:0.3cm; top: 145px;" ><i>Fecha de nacimiento:</i></h3>
        <h2 style= "font-size:0.4cm;font-family:'Times New Roman', Times, serif; position:absolute; z-index: 10; left:5.1cm; top: 139px;" ><p id="fecha1"></p></h2>

        <h3 style= "font-size:0.5cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:0.3cm; top: 165px;" ><i>Direccion de domicilio:</i></h3>
        <h2 style= "font-size:0.4cm;font-family:'Times New Roman', Times, serif; position:absolute; z-index: 10; left:0.3cm; top: 178px;" ><p id="casa"></p></h2>

        <h3 style= "font-size:0.5cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:0.3cm; top: 205px;" ><i>Direccion de trabajo:</i></h3>
        <h2 style= "font-size:0.4cm;font-family:'Times New Roman', Times, serif; position:absolute; z-index: 10; left:0.3cm; top: 218px;" ><p id="trabajo"></p></h2>

        <h3 style= "font-size:0.5cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:0.3cm; top: 250px;" ><i>Examen:</i></h3>
        <h2 style= "font-size:0.4cm;font-family:'Times New Roman', Times, serif; position:absolute; z-index: 10; left:2.3cm; top: 243px;" ><p id="examen"></p></h2>

        <h3 style= "font-size:0.5cm;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; position:absolute; z-index: 10; left:0.3cm; top: 275px;" ><i>Fecha de la prueba:</i></h3>
        <h2 style= "font-size:0.4cm;font-family:'Times New Roman', Times, serif; position:absolute; z-index: 10; left:4.7cm; top: 270px;" ><p id="fecha2"></p></h2>
    </div>

    <div id="table" style="position:absolute; top:10px; left:1060px; z-index:5; width:350px; height:500px" >
        <h2>Listado de estados por fecha</h2>

        <table cellspacing="0" cellpadding="0" border="0" width="325">
            <tr>
              <td>
                 <table cellspacing="0" cellpadding="1" border="1" width="300" >
                   <tr style="color:rgb(255, 255, 255);background-color:grey">
                      <th>Fecha</th>
                      <th>Estado</th>
                   </tr>
                 </table>
              </td>
            </tr>
            <!-- <tr>
               <td>
                 <div style="width:320px; height:80px; overflow:auto;">
                   <table cellspacing="0" cellpadding="1" border="1" width="300" >
                     
                   </table>  
                 </div>
              </td> 
            </tr> -->
          </table>
        
    </div>

    <div id="map">
    </div>

    <iframe name="dummyframe" id="dummyframe" style="display: none;"></iframe>

    <script>
        var map;
        var geocoder;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'),{
                zoom: 12, center: {lat:10.949185 ,lng: -74.803391},
                streetViewControl: false
            });
            geocoder = new google.maps.Geocoder();
        }
    
        async function validate(){
            initMap();
            if (document.getElementById('fname').value == ""){

            } else{
                var con = document.getElementById('fname').value;
                const consulta = {con:con};
                const options1 = {
                method: "POST",
                    body: JSON.stringify(consulta),
                    headers: {
                        "Content-Type": "application/json"
                    }
                };
                const response1 = await fetch('/mapaplan', options1);
                result = await response1.json();

                console.log(result);

                if (Array.isArray(result) && result.length) {
                    condicion1=true;
                } else {
                    condicion1=false;
                }

                document.getElementById("idcaso").innerHTML = result[0].idCaso;
                document.getElementById("nombre").innerHTML = result[0].nombre;
                document.getElementById("apellido").innerHTML = result[0].apellido;
                document.getElementById("cedula").innerHTML = result[0].cedula;
                document.getElementById("sexo").innerHTML = result[0].sexo;
                document.getElementById("fecha1").innerHTML = result[0].fecha_nac;
                document.getElementById("casa").innerHTML = result[0].direccion;
                document.getElementById("trabajo").innerHTML = result[0].trabajo;
                document.getElementById("examen").innerHTML = result[0].examen;
                document.getElementById("fecha2").innerHTML = result[0].fecha_examen;

                var address = result[0].direccion;
                var address1 = result[0].trabajo;
                geocoder.geocode( { 'address': address}, function(results1, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        map.setCenter(results1[0].geometry.location);
                        var marker = new google.maps.Marker({
                                map: map,
                                position: results1[0].geometry.location
                        });
                    } else {
                            alert('Geocode was not successful for the following reason: ' + status);
                    }
                });
                geocoder.geocode( { 'address': address1}, function(results2, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        map.setCenter(results2[0].geometry.location);
                        var marker = new google.maps.Marker({
                            map: map,
                            position: results2[0].geometry.location
                        });
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });
  
                var con1 = result[0].idCaso;
                const consulta2 = {con:con1};
                const options2 = {
                method: "POST",
                    body: JSON.stringify(consulta2),
                    headers: {
                        "Content-Type": "application/json"
                    }
                };
                const response2 = await fetch('/mapaplan2', options2);
                result1 = await response2.json();

                console.log(result1);
                //LLENAR TABLA
                var table = document.getElementById('table');
                result1.forEach(function(object) {
                    var tr = document.createElement('tr');
                    tr.innerHTML = '<td>' + object.fecha + '</td>' +
                    '<td>' + object.estado + '</td>';
                    table.appendChild(tr);
                });

            }
        } 
     
    </script>

    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBZFxENpr18VouKnGzRAxHJX4aOGoAXJpY&callback=initMap">
    </script>
</body>
</html>
